'use strict';

exports.__esModule = true;
exports.pureClass = pureClass;
exports.pureMethod = pureMethod;

var _function = require('./function');

var _function2 = _interopRequireDefault(_function);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function pureClass(Component) {
  var componentName = Component.displayName || Component.name || 'component';

  if (Component.prototype === undefined) {
    throw new Error(componentName + ' does not have a prototype');
  }

  if (Component.prototype.shouldComponentUpdate !== undefined) {
    throw new Error(componentName + ' already has shouldComponentUpdate');
  }

  Component.prototype.shouldComponentUpdate = _function2.default;
}

function pureMethod(target, name, descriptor) {
  var lastProps = undefined,
      lastState = undefined,
      savedResult = undefined,
      savedException = undefined;

  var oldValue = descriptor.value;
  descriptor.value = function () {
    // shouldPureComponentUpdate is symmetric, so can re-use it here.
    if (_function2.default.call(this, lastProps, lastState)) {
      lastProps = this.props;
      lastState = this.state;

      savedResult = undefined;
      savedException = undefined;

      try {
        savedResult = oldValue.apply(this, arguments);
      } catch (e) {
        savedException = e;
      }
    }

    if (savedException !== undefined) {
      throw savedException;
    }

    return savedResult;
  };

  return descriptor;
}